# 우리카드 소비 데이터 기반 신규 고객 발굴 전략 및 인사이트 도출 (ES + Kibana)

연령대(20~50대)별 카드 소비 데이터를 **Elasticsearch + Kibana**로 시각화/분석하여, **신규 고객 유치(잠재고객 정의)** 및 **카드 혜택 설계 방향**(업종·혜택 구조)에 대한 인사이트 도출 프로젝트
## 👨‍💻 팀원 소개

| <img src="https://github.com/thdus.png" width="150" height="150"/> | <img src="https://github.com/Kumin-91.png" width="150" height="150"/> | <img src="https://github.com/minchaeki.png" width="150" height="150"/> | <img src="https://github.com/young2z1.png" width="150" height="150"/> |
| :---: | :---: | :---: | :---: |
| **김소연** <br/> [@thdus](https://github.com/thdus) | **최승민** <br/> [@Kumin-91](https://github.com/Kumin-91) | **김민채** <br/> [@minchaeki](https://github.com/minchaeki) | **서주영** <br/> [@young2z1](https://github.com/young2z1) |
| 20대 데이터 분석 및 시각화 | 30대 데이터 분석 및 시각화| 40대 데이터 분석 및 시각화| 50대 데이터 분석 및 시각화|

## 📌 목차

* [1. 👤 팀원 소개](#1--팀원-소개)
* [2. ⚙️ n8n 소개 (Workflow Automation Engine)](#2-️-n8n-소개-workflow-automation-engine)
    * [2.1 🔹 프로젝트 내에서의 역할](#21--프로젝트-내에서의-역할)
* [3. 💡 주제 선정 배경](#3--주제-선정-배경--가상자산-자동-매매-파이프라인)
    * [3.1 📊 시장 분석 및 전략적 접근](#31--시장-분석-및-전략적-접근)
    * [3.2 📉 시장 분석: 기존 솔루션의 한계와 대안](#32--시장-분석-기존-솔루션의-한계와-대안)
    * [3.3 💔 기존 솔루션의 Pain Points](#1--기존-솔루션의-pain-points)
    * [3.4 ❤️‍🩹 해결책: n8n (Hybrid Workflow)](#2--해결책-n8n-hybrid-workflow)
    * [3.5 ⛳️ 프로젝트 목표](#3--프로젝트-목표)
* [4. 🏗️ 시스템 구축 환경 (System Architecture Stack)](#4-️-시스템-구축-환경-system-architecture-stack)
    * [4.1 ✅ 기술 선택 이유](#41--기술-선택-이유)
        * [4.1.1 🐘 PostgreSQL 선택 이유](#411--postgresql-선택-이유)
        * [4.1.2 ☁️ GCP 선택 이유](#412--gcp-선택-이유)
    * [4.2 🗄️ 데이터베이스 스키마 설계](#42-️-데이터베이스-스키마-database-schema)
        * [4.2.1 📝 draft_proposals (투자 제안서 관리)](#421-draft_proposals-투자-제안서-관리-테이블)
        * [4.2.2 🔭 positions (보유 종목 감시)](#422-positions-보유-종목-감시-테이블)
        * [4.2.3 📑 orders (주문 및 체결 이력)](#423-orders-주문-및-체결-이력-테이블)
* [5. 🔑 운영 환경 변수 및 보안 설정](#5--운영-환경-변수-설정-runtime-environment-configuration)
    * [5.1 🔑 주요 환경 변수 요약](#51--주요-환경-변수-요약)
    * [5.2 🔐 Secret Manager 연동 항목](#52--secret-manager-연동-항목)
* [6. 🔄 핵심 워크플로우 설계 (Core Workflow Design)](#6--핵심-워크플로우-설계-core-workflow-design)
    * [6.1 💬 AI 기반 트레이딩 챗봇](#61--ai-기반-트레이딩-챗봇-워크플로우)
    * [6.2 📄 투자 제안 생성 워크플로우](#62--투자-제안-생성-워크플로우)
        * [6.2.1 🔹 Workflow 1 – 제안서 생성](#-workflow-1--투자-제안서-생성-및-알림)
        * [6.2.2 🔹 Workflow 2 – 승인 및 주문](#-workflow-2--draft-승인-처리-및-주문-준비)
* [7. 🚨 트러블슈팅 (Troubleshooting)](#7--트러블슈팅-troubleshooting)
* [8. 🚀 한계 및 향후 개선 사항](#8--한계-및-향후-개선-사항-limitations--future-improvements)
* [9. 📖 용어 정리](#9--용어-정리)

---

## 1. 프로젝트 개요

### 배경

카드 상품(특히 Travel Card 등)은 특정 연령대가 자주 소비하는 업종에 혜택이 집중되는 경우가 많습니다. 본 프로젝트는 **연령대별 소비 패턴의 집중도/차이**를 데이터로 확인하고, 이를 기반으로 다음의 **데이터 기반 신규 고객 발굴 전략**을 도출하는 것을 목표로 했습니다.

1. 기존 고객의 이용 활성화(혜택 최적화)
2. 타사 고객 유입(차별화된 혜택 설계)

### 목표

* 연령대별 소비 데이터를 시각화하여 **Top 업종/소비 구조/결제 성향**을 파악
* 인사이트를 바탕으로 **유치 전략 및 카드 혜택 설계 힌트** 제시
* 대용량 데이터 환경에서 분석 효율을 높이기 위한 **SQL 전처리 및 구조 재편(UNPIVOT)** 수행

---

## 2. 연령대별 핵심 인사이트 및 유치 전략

> 공통적으로 ‘유통/유통업영리’가 상위에 크게 나타날 수 있으나, 일부는 상위 카테고리로 묶여 생기는 **통계적 착시** 가능성이 있어 정밀 타겟팅/혜택 설계 시에는 **세부 분류 재검토 또는 제외 전략**을 병행했습니다.

---

### 🐣 20대

<img width="1912" height="708" alt="20대" src="https://github.com/user-attachments/assets/36169224-999f-4e18-aac2-21530320f976" />

> [!NOTE]
> 20대는 소비가 유통·외식에 강하게 집중되어 있어, 자주 쓰는 소수 업종에 혜택을 몰아주는 카드가 전환 효과가 높습니다.

#### 1) 관측(What we saw)

* 40개 업종 중 **유통**(**DIST, DISTBP**)이 압도적 상위
* 다음 축은 **외식(FSBZ, RESTRNT)** 중심
* 여행·보험·의료·생활서비스는 상위권에 포함되더라도 **보조 영역** 성격

#### 2) 해석(Why it happens)

* 20대는 소비 카테고리가 아직 넓게 확장되지 않아 **‘선택과 집중’ 구조**가 강함
* 유통·외식은 총액(SUM), 건수(COUNT), 평균(AVG) 지표가 함께 높아
  **일시적 고액이 아니라 반복적·구조적 소비**로 해석 가능
* 의료·보험은 전체 주력 소비라기보다 **특정 하위 세그먼트의 정기/반복 결제**가 반영된 결과일 수 있음

#### 3) 전략(What to do)

* 혜택 설계는 “전 업종 조금씩”보다 **유통·외식 등 상위 소수 업종 집중**이 유리
* “월 1회 고액 할인”보다 **횟수 기반 / 소액 누적 할인** 등 반복 체감형 구조가 적합
* 의료·보험은 유치보다는 **락인(lock-in)용(정기결제 유지)** 혜택으로 설계

---

### 💼 30대

<img width="1800" height="855" alt="30대" src="https://github.com/user-attachments/assets/f80d38c6-0988-4ca8-87c7-ca53803b4e06" />

> [!NOTE]
> 30대는 고정지출·생활서비스 지출이 확대되는 구간이므로, 자동이체 기반 락인 혜택과 신용카드 중심 프로모션이 유입에 유리합니다.

#### 1) 관측(What we saw)

* (SUM/COUNT Top) 요식·외식(FSBZ, RESTRNT), 보험/의료(INSUHOS, HOS), 여행/레저(TRVLEC), 생활 서비스(SVC/SVCARC)가 상위권
* (AVG 고단가 업종) 학원(ACDM), 자동차/정비(AUTO/AUTOMNT), 의류(CLOTH 계열), 시설관리(BLDMNG) 등이 두드러짐
* 카드 유형 비중에서 **신용카드 비중이 높음(예: 70%)**

#### 2) 해석(Why it happens)

* 30대는 소비 카테고리가 넓어지며 **고정지출(교육/관리비/구독) + 생활 서비스** 비중이 증가
* ‘유통/유통업영리’는 다양한 소매점이 상위 카테고리로 묶여 나타나는 **통계적 착시** 가능성이 높아
  정밀 타겟팅 시 그대로 활용하면 왜곡될 수 있음
* 신용카드 쏠림은 고액 결제/할부/정기 결제에서 **신용카드 선호가 구조적으로 존재**함을 시사

#### 3) 전략(What to do)

* **고정지출 락인**이 핵심: 학원비/관리비/정기구독 등 자동이체 혜택 강화
* 신용카드 교체 유인을 만들기 위해 **무이자 할부/청구 할인/자동이체 추가 적립**을 전면에 배치
* ‘유통’은 세부 분류가 확보되지 않으면 **분석·혜택 설계에서 제외하거나 재분류** 후 활용

---

### ⚖️ 40대

<img width="2936" height="1616" alt="40대" src="https://github.com/user-attachments/assets/3bb6786f-24e6-49d0-9129-750b4cf1da84" />

> [!NOTE]
> 40대는 큰 지출과 분산된 일상 결제가 공존하므로, ‘고액 적립 + 범용 할인’을 함께 제공하는 신용카드 중심 락인 전략이 적합합니다.

#### 1) 관측(What we saw)

* (SUM) 유통 관련 항목이 상위권으로 크게 나타나며, **큰 지출처가 존재**하는 양상
* (COUNT) 총액 대비 **Other 비중이 높아**, 소액 결제가 다양한 업종에 분산됨
* 카드 유형에서 **신용카드 사용 비중이 높게 관측**되는 경향

#### 2) 해석(Why it happens)

* 40대는 “특정 목적의 큰 지출”과 “일상 분산형 소액 결제”가 동시에 나타나는 구조
* 즉, 단일 업종 혜택만으로는 커버가 어려워 **대형 지출/일상 지출을 동시에 잡는 설계**가 필요

#### 3) 전략(What to do)

* 큰 지출처에는 **포인트 적립/프리미엄(등급형) 혜택**
* 분산된 일상 결제에는 **범용 할인/생활 밀착형 혜택**을 제공해 총사용량을 끌어올림
* 체크카드보다 **신용카드(할부·멤버십·우대서비스)** 중심 메시지가 효과적

---

### 👑 50대

<img width="1905" height="654" alt="50대" src="https://github.com/user-attachments/assets/dd7a5f00-f77e-4556-b216-38c50a5b92dc" />


> [!NOTE]
> 50대는 교육·건강·안정 지출이 뚜렷한 우량 고객군이므로, 핵심 라이프 지출에 집중한 신용카드형 시니어 혜택 설계가 효과적입니다.

#### 1) 관측(What we saw)

* 평균 소비값 기준 상위권에 **교육(학원), 사무/서적, 보험/병원, 의료, 외식** 등이 포함
* 카드 유형은 **신용카드 비중이 압도적**이며, 고액·정기 결제 성향이 강함
* 결제 횟수도 함께 비교했을 때, 금액뿐 아니라 **자주 쓰는 업종이 뚜렷**함

#### 2) 해석(Why it happens)

* 50대는 **교육/관리**(**자녀·자기계발**)와 **건강/안정(보험·의료·노후)** 지출이 두드러짐
* 신용카드 중심 소비는 우량 고객군(고액·정기 결제)의 특징과 맞물려
  혜택 설계를 잘 하면 **장기 유지(락인) 효과**가 큼

#### 3) 전략(What to do)

* **시니어-라이프 카드** 컨셉으로 핵심 지출(학원/서적/보험/대형병원)에 캐시백·청구 할인 집중
* 프로모션은 **신용카드 중심**으로 설계하고, 가맹점 제휴 + 타겟 메시지(SMS 등)로 도달률 강화
* 유통은 필수 소비로 모든 세대 공통이므로, 차별화를 위해 **핵심 라이프 지출 중심으로 혜택을 재배치**

---

## 3. 데이터 처리 및 분석 방법

### 핵심 접근

1. **데이터 구조 재편(UNPIVOT)**

* Kibana에서 분석/필터링이 쉬운 **long-format(category, spend)** 형태로 변환

2. **데이터 정제 및 무결성 확보**

* 결측치(NULL), 0 값 처리로 분석 왜곡 방지
* (필요 시) 타입 캐스팅/이상치 제거로 오류 예방

3. **심층 분석**

* 상위 업종 집중 현상(특히 유통)의 원인 분석 및 **통계적 착시 가능성** 제시
* SUM/COUNT/AVG 지표를 함께 비교하여 “일시적 고액 vs 반복적 소비” 구분

---

## 4. 시각화 구성 (Kibana)

연령대별로 다음 축을 중심으로 대시보드를 구성했습니다.

* **Top N 업종 (SUM)**: 카테고리별 누적 이용액 상위 업종
* **Top N 업종 (COUNT)**: 결제 빈도가 높은 업종
* **분기별 평균 결제 단가 (AVG)**: 고단가 지출 업종 파악
* **체크카드 vs 신용카드 비중**: 결제 수단 성향 기반 프로모션 설계

---

## 5. 실행 방법 (재현)

> 아래는 “CSV 생성 → Kibana 업로드 → 대시보드 확인”까지의 최소 재현 흐름입니다.

### 1) 데이터 UNPIVOT 후 CSV 추출

* 원본 테이블(wooricard)을 long-format으로 변환
* `spend > 0` 조건으로 의미 있는 결제만 필터링
* 필요한 연령대(예: 30/35 등)만 추출하여 분석 효율 확보

예시(SQL):

```sql
COPY (
  SELECT *
  FROM (
    UNPIVOT wooricard
    ON <세부 결제 내역명, 외부 반출 불가로 삭제>
    INTO NAME category VALUE spend
  )
  WHERE spend > 0 AND (AGE = '30' OR AGE = '35')
)
TO './kibana_final_data.csv' (HEADER);
```

### 2) Kibana에서 CSV Import

* Kibana → **Upload file** → `kibana_final_data.csv` 업로드
* 필드 타입(AGE, category, spend 등) 매핑 확인

### 3) Dashboard 구성

* Lens(또는 Visualize)로 Top N / 시계열 / 비중 차트 생성
* 연령대별 Dashboard로 정리하여 비교

---

## 6. 트러블슈팅

* **대용량 데이터로 인한 가공 필요**

  * 연령대별로 분리 후, Top 5~7(또는 Top 9) 업종 중심으로 추출하여 시각화 성능 개선

* **같은 필드(카테고리) 색상 구분이 어려운 문제**

  * Kibana 시각화에서 **Breakdown** 활용해 범례/색상 구분 개선

---

## 7. 한계 및 향후 개선

### 한계

* 지리 정보(거주지-가맹점 위치) 결합이 불가능하여 **장거리 출퇴근자**(**자동차 지출이 크고 거주지/사용지가 다른 고객**)를 정교하게 타겟팅하지 못함

### 향후 개선

* 거주지/가맹점 위치 데이터를 결합하면

  * 광역 출퇴근러 맞춤 혜택(주유/정비/자동차 관련) 설계 가능
  * 지역 기반 세그먼트 마케팅(거주지 중심 프로모션) 고도화 가능
